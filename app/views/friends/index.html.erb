<div class="container my-4">
  <div class="row">
    <div class="col-12 mb-4">
      <h1 class="text-center">Friends List</h1>
    </div>

    <div class="col-12">
      <div class="card shadow-sm mb-4">
        <div class="card-header">
          My Friends
        </div>
        <ul class="list-group list-group-flush">
          <% @friends.each do |friend| %>
            <% if policy(friend).show? %>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                  <% user = friend.user == current_user ? friend.attendee : friend.user %>
                  <div class="friends-avatar me-2">
                    <% if user.photo.attached? %>
                      <%= cl_image_tag user.photo.key, class: 'avatar-image friends-avatar', title: user.full_name %>
                    <% else %>
                      <%= image_tag "default-avatar.avif", class: 'avatar-image friends-avatar', title: user.full_name %>
                    <% end %>
                  </div>
                  <%= content_tag :span, user.try(:full_name), class: "user-name" %> <!-- Apply user-name class -->
                </div>
                <% if policy(friend).destroy? %>
                  <%= link_to friend_path(friend), data: { turbo_method: :delete, turbo_confirm: 'Are you sure?' }, title: "Remove", class: "remove-btn" do %>
                    <%= image_tag 'remove.png', alt: 'Remove', style: 'width: 20px; height: 20px;' %>
                  <% end %>
                <% end %>
              </li>
            <% end %>
          <% end %>
        </ul>
      </div>
    </div>

    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-body">
          <h2 class="card-title text-center mb-4">Add Friend</h2>
          <%= form_with model: Friend.new, url: friends_create_path, local: true do |form| %>

            <% if policy(Friend.new).create? %>
              <div class="form-group mb-3">
                <%= form.label :attendee_id, "Full Name", class: "form-label" %>
                <%= form.collection_select :attendee_id, @users, :id, :full_name, { prompt: "Select a friend" }, { class: "form-select", data: { controller: "tom-select" } } %>
              </div>
              <div class="d-grid">
                <%= form.submit "Add Friend", class: "btn btn-primary" %>
              </div>
            <% else %>
              <p class="text-center text-muted">You are not authorized to add friends.</p>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
